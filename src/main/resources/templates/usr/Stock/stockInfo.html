<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{usr/layout/layout.html}">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

    <style>
        .text-red {
            color: red;
        }

        .text-blue {
            color: blue;
        }
    </style>

    <title>ì£¼ì‹ ì •ë³´</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // ì°¨íŠ¸ì— ì‚¬ìš©í•  ë°ì´í„°
            var data = {
                labels: ["ë§¤ìˆ˜ ê°•ë ¥ ì¶”ì²œ", "ë§¤ìˆ˜ ì¶”ì²œ", "ì¤‘ë¦½", "ë§¤ë„ ì¶”ì²œ", "ë§¤ë„ ê°•ë ¥ ì¶”ì²œ"],
                datasets: [{
                    data: [${stock.strongBuy}, ${stock.buy}, ${stock.hold}, ${stock.sell}, ${stock.strongSell}],
                    backgroundColor: [
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(153, 102, 255, 0.2)'
                    ],
                    borderColor: [
                        'rgba(75, 192, 192, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            };

            // ì°¨íŠ¸ ìƒì„±
            var ctx = document.getElementById('chart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: data,
                options: {
                    responsive: true
                }
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $('#newsButton').click(function () {
                var symbol = $('#symbol').text();
                window.location.href = '/stocks/news/' + symbol;
            });
        });
    </script>
</head>
<div layout:fragment="content" class="d-flex flex-column align-items-center max-w-3xl mx-auto">
    <h1 class="display-4 text-center my-5"
        style="font-family: 'Arial', sans-serif; font-size: 2em; font-weight: bold; color: #333;">[[${stock.getSymbol}]]
        ì •ë³´</h1>
    <div>
        <span style="font-weight: bold;">Symbol:</span> [[${stock.getSymbol}]]&nbsp;&nbsp;&nbsp;
        <span th:if="${stock.currentPrice > stock.previousClose}" style="color: red">+</span>
        <span th:text="${#numbers.formatDecimal(stock.currentPrice - stock.previousClose, 1, 2)}"></span>
        <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span> (
        <span th:text="${(stock.previousClose != 0) ?
    ((stock.currentPrice > stock.previousClose) ?
        #numbers.formatDecimal(((stock.currentPrice - stock.previousClose) / stock.previousClose) * 100, 1, 2) + '%â†‘' :
        #numbers.formatDecimal(((stock.currentPrice - stock.previousClose) / stock.previousClose) * 100, 1, 2) + '%â†“') : '0.00'}"
              th:class="${(stock.currentPrice > stock.previousClose) ? 'text-red' : (stock.currentPrice < stock.previousClose ? 'text-blue' : '')}"></span>)
        <button id="newsButton" style="padding: 10px 20px; background-color: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-size: 1.2em;">ê¸°ì—… ê´€ë ¨ ë‰´ìŠ¤ ë³´ê¸°</button>
    </div>

    <div class="d-flex flex-column align-items-center mt-4 max-w-3xl mx-auto">

        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">ê¸°ë³¸ ì •ë³´</h5>
                        <p class="card-text">
                            ğŸ‘‰ ì „ì¼ ì¢…ê°€ :<br>
                            <span th:text="${stock.previousClose}"></span>
                            <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                        </p>
                        <p class="card-text">
                            ğŸ‘‰ ë‹¹ì¼ ì¢…ê°€ :<br>
                            <span th:text="${stock.currentPrice}"></span>
                            <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                        </p>
                        <p class="card-text">
                            ğŸ‘‰ ì‹œê°€ì´ì•¡ :<br>
                            <span th:text="${stock.marketCap}"></span>
                            <span th:if="${stock.getSymbol.matches('[A-Za-z].*')}" class="ml-1">$</span>
                            <span th:unless="${stock.getSymbol.matches('[A-Za-z].*')}" class="ml-1">&#8361;</span>
                        </p>

                        <p class="card-text" th:if="${stock.forwardPE != null}">
                            ğŸ‘‰ PER :<br>
                            <span th:text="${stock.forwardPE}"></span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">ë°°ë‹¹ê¸ˆ ì •ë³´</h5>
                        <span th:if="${stock.dividendRate != null}">
                <p class="card-text">
                    ğŸ‘‰ ë°°ë‹¹ê¸ˆ :<br>
                    <span th:text="${stock.dividendRate}"></span>
                    <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                </p>
                <p class="card-text">
                    ğŸ‘‰ ë°°ë‹¹ ë¹„ìœ¨ :<br>
                    <span th:text="${stock.dividendYield * 100}"></span>%
                </p>
                <p class="card-text">
                    ğŸ‘‰ ë°°ë‹¹ê¶Œ ë¶„ë¦¬ì¼ :<br>
                    <span th:text="${stock.exDividendDate}"></span>
                </p>
            </span>
                        <span th:unless="${stock.dividendRate != null}">
                <p class="card-text">
                    í•´ë‹¹ íšŒì‚¬ëŠ” ë°°ë‹¹ê¸ˆì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” íšŒì‚¬ì…ë‹ˆë‹¤.
                </p>
            </span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="card mt-4">
                        <div class="card-body">
                            <h5 class="card-title">ì°¨íŠ¸ì  ì˜ë¯¸</h5>
                            <p class="card-text">
                                ğŸ‘‰ 52ì£¼ ìµœì €ê°€ :<br>
                                <span th:text="${#numbers.formatInteger(stock.fiftyTwoWeekLow,3)}"></span>
                                <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                            </p>
                            <p class="card-text">
                                ğŸ‘‰ 52ì£¼ ìµœê³ ê°€ :<br>
                                <span th:text="${stock.fiftyTwoWeekHigh}"></span>
                                <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                            </p>
                            <p class="card-text">
                                ğŸ‘‰ 52ì£¼ í‰ê· ê°€ :<br>
                                <span th:text="${stock.fiftyDayAverage}"></span>
                                <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                            </p>
                            <p class="card-text">
                                ğŸ‘‰ ìµœê·¼ 12ê°œì›” ë§¤ì¶œì•¡ ëŒ€ë¹„ ì£¼ê°€ ë¹„ìœ¨:<br>
                                <span th:text="${stock.priceToSalesTrailing12Months}"></span>
                            </p>
                            <p class="card-text">
                                ğŸ‘‰ 200ì¼ ì´ë™ í‰ê· ì£¼ê°€ :<br>
                                <span th:text="${stock.twoHundredDayAverage}"></span>
                                <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card mt-4">
                        <div class="card-body">
                            <h5 class="card-title">ì• ë„ë¦¬ìŠ¤íŠ¸ ì˜ê²¬</h5>
                            <p class="card-text">
                                ğŸ‘‰ ì• ë„ë¦¬ìŠ¤íŠ¸ ëª©í‘œ ìµœê³ ê°€ :<br>
                                <span th:text="${stock.targetHighPrice}"></span>
                                <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                            </p>
                            <p class="card-text">
                                ğŸ‘‰ ì• ë„ë¦¬ìŠ¤íŠ¸ ëª©í‘œ ìµœì €ê°€ :<br>
                                <span th:text="${stock.targetLowPrice}"></span>
                                <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                            </p>
                            <p class="card-text">
                                ğŸ‘‰ ì• ë„ë¦¬ìŠ¤íŠ¸ë“¤ì˜ í‰ê· ê°€ :<br>
                                <span th:text="${stock.targetMedianPrice}"></span>
                                <span th:text="${(stock.getSymbol.matches('[A-Za-z]+')) ? '$(ë‹¬ëŸ¬)' : 'â‚©(ì›)'}"></span>
                            </p>
                            <p class="card-text">
                                ğŸ‘‰ í¼ì„¼íŠ¸~~~~:<br>
                                <span>ë§¤ìˆ˜ ê°•ë ¥ ì¶”ì²œ</span>
                                <span th:text="${stock.strongBuy}"></span>
                                <span>ë§¤ìˆ˜ ì¶”ì²œ</span>
                                <span th:text="${stock.buy}"></span>
                                <span>ì¤‘ë¦½</span>
                                <span th:text="${stock.hold}"></span>
                                <span>ë§¤ë„ ì¶”ì²œ</span>
                                <span th:text="${stock.sell}"></span>
                                <span>ë§¤ë„ ê°•ë ¥ ì¶”ì²œ</span>
                                <span th:text="${stock.strongSell}"></span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <!--        ì°¨íŠ¸ ë¶€ë¶„-->
        <canvas id="chart" width="400" height="400"></canvas>
        <!--        ì°¨íŠ¸ ë¶€ë¶„-->
        <br>
        <p class="card-text font-weight-bold text-danger">
            âš ï¸ ì£¼ì˜: ìœ„ì˜ ì •ë³´ë“¤ì€ ì£¼ì‹ íˆ¬ì ì‹œ ê°€ì¹˜ì™€ ê°€ê²©ì„ íŒë‹¨í•˜ê³  ë¹„êµí•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ íˆ¬ì ê²°ì •ì€ ë‹¤ì–‘í•œ ìš”ì†Œë¥¼ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•´ì•¼ í•˜ë©°, ë‹¨ì¼ ì§€í‘œë§Œì„ ê·¼ê±°ë¡œ íŒë‹¨í•˜ëŠ” ê²ƒì€
            ê¶Œì¥ë˜ì§€
            ì•ŠìŠµë‹ˆë‹¤.
        </p>
    </div>
    <span id="symbol" th:text="${stock.getSymbol}" style="display:none"></span>
</html>